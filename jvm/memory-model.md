---
description: 图灵学院
---

# 内存模型

## JVM内存模型

![JVM&#x5185;&#x5B58;&#x6A21;&#x578B;](../.gitbook/assets/jvm-nei-cun-mo-xing.jpg)

## 栈

栈\(线程\) 保存线程信息：线程内局部产量（？），栈帧\(每调用一个方法，都新建一个与之对应的栈帧\) 。

栈帧作用：体现变量的作用域。栈帧内部包含： 

* 局部产量栈：保存栈帧对应方法的局部产量 
* 操作数栈：保存程序运行过程中的中间变量。 jvm的load将整型加载到操作数栈，四则运算也从操作数栈顶取操作数。 
* 动态链接：指向类元信息中的方法，将符号形式的方法调用翻译成实际方法调用。 
* 方法出口：指向调用本方法的位置

## 堆

保存new出来的对象\(new出来的对象中都有一个指针，指向该类的类元信息，动态链接\)。 

！！！堆 new出来的对象\(保存在堆中的内容\)什么时候被销毁？

堆内存大小可以配置，以600兆为例，默认老年代占400兆\(2/3\)，年轻代占200兆\(1/3\)，eden区占160兆\(年轻代的8/10\)。

1）eden区占满之后，gc线程释放eden区中没有指针指向的对象；

2）若再次占满，将有指针指向的对象被移动到from区，

3）若from区在被占满，清理无用对象，有用对象被移动到to区域，to区域成为新的from, 原来的from成为to。

4）上述to和from的一次交替成为一次轮循，15次循环之后依然没有被清理的对象被移动到老年代，

5）老年代满之后，进行full gc。 

年轻代的gc称为manner gc, 老年代的gc成为full gc, full gc的过程非常慢。 若full gc的清理没有释放内存空间\(比如程序设计错误引发内存泄露\)，此时发生oom\(out of memory\).

## 方法区/元空间

保存静态变量，常量，类元信息\(类的模板\)

**注意！**堆和方法区线程共享。 线程栈，本地方法栈和程序计数器 线程独享。

## 本地方法栈

调用本地方法时保存局部产量的栈 用native修饰的方法是本地方法，本地方法会调用c语言的库函数\(类似于系统调用\)，现在用的比较少了。 

程序计数器

字节码文件被类加载器拆解，对应的数据放到内存模型的对应位置。

Javap -c 对class文件进行反汇编，生成汇编文件，对照jvm指令手册可以查看汇编命令的含义。



